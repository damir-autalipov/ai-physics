<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ò–ò ‚Äî –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
<style>
:root {
  --bg:#f6f7f9;--card:#ffffff;--text:#202124;
  --muted:#6b7280;--border:#dcdfe3;
  --accent:#2563eb;--accent2:#7c3aed;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);
display:flex;justify-content:center;padding:40px;}
.wrap{width:100%;max-width:1200px;}
h1{font-size:24px;margin-bottom:8px;}
p{color:var(--muted);font-size:14px;}
.grid{display:grid;grid-template-columns:360px 1fr;gap:18px;}
.panel{background:var(--card);border:1px solid var(--border);
border-radius:10px;padding:18px;box-shadow:0 4px 10px rgba(0,0,0,0.04);}
textarea,input[type="text"]{width:100%;border:1px solid var(--border);
border-radius:8px;padding:8px;margin-top:6px;font-size:14px;background:#fff;}
label{font-weight:600;font-size:14px;margin-top:10px;display:block;}
button{background:var(--accent);color:white;border:none;border-radius:8px;
padding:10px 12px;font-weight:600;cursor:pointer;margin-top:12px;}
button.ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
.exp-card{display:flex;align-items:center;gap:10px;border:1px solid var(--border);
border-radius:8px;padding:8px;cursor:pointer;margin-top:6px;}
.exp-card.active{border-color:var(--accent);background:#eef2ff;}
.exp-icon{width:38px;height:38px;border-radius:6px;background:var(--accent);
color:white;display:flex;align-items:center;justify-content:center;font-weight:700;}
#plot{width:100%;height:420px;}
.pill{background:#f8fafc;padding:6px 10px;border-radius:8px;border:1px solid var(--border);font-size:13px;}
footer{color:var(--muted);font-size:12px;margin-top:20px;text-align:center;}
.tooltip{position:relative;display:inline-block;}
.tooltiptext{
visibility:hidden;background-color:#333;color:#fff;text-align:left;border-radius:6px;
padding:8px 10px;position:absolute;z-index:1;bottom:125%;left:50%;transform:translateX(-50%);
opacity:0;transition:opacity 0.3s;width:260px;font-size:12px;line-height:1.3;
}
.tooltip:hover .tooltiptext{visibility:visible;opacity:1;}
#matchPercent{font-weight:700;}
table{border-collapse:collapse;width:100%;font-size:13px;margin-top:10px;}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:left;}
thead{background:#f3f4f6;}
</style>
</head>
<body>
<div class="wrap">
<h1>–ò–ò ‚Äî –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h1>
<p>–ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–¥–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –µ—ë —Å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–∫–æ–Ω–æ–º.</p>

<div class="grid" style="margin-top:20px;">
  <div class="panel">
    <strong>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</strong>
    <div class="exp-card" data-mode="ohm"><div class="exp-icon">Œ©</div><div>–ó–∞–∫–æ–Ω –û–º–∞</div></div>
    <div class="exp-card" data-mode="pendulum"><div class="exp-icon">‚è±</div><div>–ú–∞—è—Ç–Ω–∏–∫</div></div>
    <div class="exp-card" data-mode="fall"><div class="exp-icon">‚¨áÔ∏è</div><div>–°–≤–æ–±–æ–¥–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ</div></div>
    <div class="exp-card active" data-mode="custom"><div class="exp-icon">‚ú≥Ô∏è</div><div>–ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å</div></div>

    <label>–†—è–¥ A (X)</label>
    <textarea id="inputA" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1, 2, 3, 4"></textarea>

    <label>–†—è–¥ B (Y)</label>
    <textarea id="inputB" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2, 4.1, 5.9, 8.2"></textarea>

    <label>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ—é —Ñ–æ—Ä–º—É–ª—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
    <input type="text" id="userFormula" placeholder="y = 2*x + 1">

    <button id="btnAnalyze">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="ghost" id="btnExample">–ü—Ä–∏–º–µ—Ä</button>
  </div>

  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div>
        <strong id="resultTitle">–ì–æ—Ç–æ–≤ –∫ –∞–Ω–∞–ª–∏–∑—É</strong><br>
        <span id="resultSub" style="color:var(--muted);font-size:13px;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å¬ª</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div class="tooltip">
          <div class="pill" id="pillR2">R¬≤ ‚Äî</div>
          <span class="tooltiptext">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏ R¬≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –º–æ–¥–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (1 = –∏–¥–µ–∞–ª—å–Ω–æ, 0 = –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç).</span>
        </div>
        <div class="pill" id="pillError">Œî% ‚Äî</div>
      </div>
    </div>

    <div id="plot"></div>

    <div style="margin-top:12px;">
      <b>–≠–º–ø–∏—Ä–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å:</b> <span id="bestModelFormula">‚Äî</span><br>
      <b>–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å:</b> <span id="theoryFormula">‚Äî</span><br>
      <b>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª—å—é:</b> <span id="matchPercent">‚Äî</span><br>
      <b>–ü–æ—è—Å–Ω–µ–Ω–∏–µ:</b>
      <div id="explanation" style="margin-top:6px;color:var(--muted);font-size:13px;"></div>
    </div>

    <div id="modelComparison" style="margin-top:20px;">
      <h4 style="margin-bottom:6px;">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</h4>
      <table id="comparisonTable">
        <thead>
          <tr><th>–ú–æ–¥–µ–ª—å</th><th>R¬≤</th><th>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —Ç–µ–æ—Ä–∏–µ–π</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<footer>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è —É—á–µ–±–Ω—ã—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç —Å –ò–ò</footer>
</div>

<script>
let mode='custom';
document.querySelectorAll('.exp-card').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.exp-card').forEach(x=>x.classList.remove('active'));
    c.classList.add('active'); mode=c.dataset.mode;
  });
});

function parseSeries(str){return str.split(/,|;|\s+/).map(s=>parseFloat(s)).filter(x=>!isNaN(x));}
function r2(y,yp){const m=math.mean(y);const ssr=math.sum(y.map((yi,i)=>(yi-yp[i])**2));const sst=math.sum(y.map(yi=>(yi-m)**2));return 1-ssr/sst;}
function err(y,yp){const eps=1e-9;return math.mean(y.map((yi,i)=>Math.abs(yi-yp[i])/Math.max(Math.abs(yi),eps)))*100;}
function fitLinear(x,y){const mx=math.mean(x),my=math.mean(y);const a=math.sum(x.map((xi,i)=>(xi-mx)*(y[i]-my)))/math.sum(x.map(xi=>(xi-mx)**2));return {a:a,b:my-a*mx};}
function fitQuad(x,y){try{const X=math.matrix(x.map(xi=>[xi*xi,xi,1]));const Y=math.matrix(y);const t=math.multiply(math.inv(math.multiply(math.transpose(X),X)),math.multiply(math.transpose(X),Y)).toArray().flat();return {A:t[0],B:t[1],C:t[2]};}catch(e){return{A:0,B:0,C:0};}}

document.getElementById('btnExample').onclick=()=>{
  if(mode==='ohm'){inputA.value='1,2,3,4';inputB.value='1,0.5,0.33,0.25';}
  else if(mode==='pendulum'){inputA.value='0.1,0.2,0.3,0.4';inputB.value='0.63,0.9,1.09,1.26';}
  else if(mode==='fall'){inputA.value='0.2,0.4,0.6,0.8';inputB.value='0.2,0.8,1.8,3.2';}
  else {inputA.value='1,2,3,4,5';inputB.value='2,4.1,5.9,8.1,9.9';}
};

document.getElementById('btnAnalyze').onclick=()=>{
  const x=parseSeries(inputA.value),y=parseSeries(inputB.value);
  if(x.length<3||x.length!==y.length){alert('–í–≤–µ–¥–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫');return;}

  let vars={x:'x',y:'y'};
  if(mode==='ohm') vars={x:'U',y:'I'};
  else if(mode==='pendulum') vars={x:'L',y:'T'};
  else if(mode==='fall') vars={x:'t',y:'h'};

  // –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏
  const lin=fitLinear(x,y);
  const ylin=x.map(xi=>lin.a*xi+lin.b);
  const q=fitQuad(x,y);
  const yq=x.map(xi=>q.A*xi*xi+q.B*xi+q.C);
  const rlin=r2(y,ylin), rq=r2(y,yq);

  // –¢–µ–æ—Ä–∏—è
  let theory='',ytheory=[];
  if(mode==='ohm'){const R=1/lin.a;ytheory=x.map(U=>U/R);theory=`I = U / R, R ‚âà ${R.toFixed(3)} Œ©`;}
  else if(mode==='pendulum'){const T2=y.map(t=>t*t);const lin2=fitLinear(x,T2);const s=lin2.a;const g=(4*Math.PI*Math.PI)/s;ytheory=x.map(L=>2*Math.PI*Math.sqrt(L/g));theory=`T = 2œÄ‚àö(L/g), g ‚âà ${g.toFixed(3)} –º/—Å¬≤`;}
  else if(mode==='fall'){const t2=x.map(t=>t*t);const lin2=fitLinear(t2,y);const s=lin2.a;const g=2*s;ytheory=x.map(t=>0.5*g*t*t);theory=`h = ¬Ω¬∑g¬∑t¬≤, g ‚âà ${g.toFixed(3)} –º/—Å¬≤`;}

  const best=(rlin>=rq)?{type:'–ª–∏–Ω–µ–π–Ω–∞—è',f:`${vars.y}=${lin.a.toFixed(4)}¬∑${vars.x}${lin.b>=0?'+':'-'}${Math.abs(lin.b).toFixed(4)}`,y:ylin,r:rlin}:{type:'–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è',f:`${vars.y}=${q.A.toFixed(4)}¬∑${vars.x}¬≤${q.B>=0?'+':'-'}${Math.abs(q.B).toFixed(4)}¬∑${vars.x}${q.C>=0?'+':'-'}${Math.abs(q.C).toFixed(4)}`,y:yq,r:rq};

  let matchValue=0,color='black';
  if(ytheory.length>0){matchValue=100-err(best.y,ytheory);if(matchValue>90)color='#16a34a';else if(matchValue>70)color='#facc15';else color='#dc2626';}

  // –ì—Ä–∞—Ñ–∏–∫
  const traces=[
    {x,y,mode:'markers',name:'–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç',marker:{color:'#2563eb',size:8}},
    {x,y:best.y,mode:'lines',name:'–õ—É—á—à–∞—è –º–æ–¥–µ–ª—å',line:{color:'#7c3aed',width:3}},
  ];
  if(ytheory.length) traces.push({x,y:ytheory,mode:'lines',name:'–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å',line:{color:'#10b981',dash:'dot',width:3}});
  Plotly.newPlot('plot',traces,{margin:{t:30,l:60,r:20,b:60},xaxis:{title:vars.x},yaxis:{title:vars.y},legend:{orientation:'h'}});

  // –í—ã–≤–æ–¥
  document.getElementById('bestModelFormula').textContent=best.f;
  document.getElementById('theoryFormula').textContent=theory||'‚Äî';
  const matchEl=document.getElementById('matchPercent');matchEl.textContent=matchValue.toFixed(2)+'%';matchEl.style.color=color;
  document.getElementById('pillR2').textContent='R¬≤ = '+best.r.toFixed(4);
  document.getElementById('pillError').textContent='Œî% = '+err(y,best.y).toFixed(2)+'%';
  document.getElementById('resultTitle').textContent='–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω';
  document.getElementById('explanation').innerHTML=`–ò–ò –≤—ã–±—Ä–∞–ª <b>${best.type}</b> –º–æ–¥–µ–ª—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏–º–µ–µ—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π R¬≤ (${best.r.toFixed(4)}). –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —Ç–µ–æ—Ä–∏–µ–π: <b style="color:${color}">${matchValue.toFixed(2)}%</b>.`;

  // --- –¢–∞–±–ª–∏—Ü–∞ 5 –º–æ–¥–µ–ª–µ–π ---
  const models=[];
  models.push({name:"–õ–∏–Ω–µ–π–Ω–∞—è",y:ylin,r2:rlin});
  models.push({name:"–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è",y:yq,r2:rq});

  // –°—Ç–µ–ø–µ–Ω–Ω–∞—è
  try{const logx=x.map(v=>Math.log(v)),logy=y.map(v=>Math.log(v));const linLog=fitLinear(logx,logy);
  const aPow=Math.exp(linLog.b),bPow=linLog.a;const ypow=x.map(v=>aPow*Math.pow(v,bPow));models.push({name:"–°—Ç–µ–ø–µ–Ω–Ω–∞—è",y:ypow,r2:r2(y,ypow)});}catch(e){}
  // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è
  try{const logy=y.map(v=>Math.log(v));const linExp=fitLinear(x,logy);
  const aExp=Math.exp(linExp.b),bExp=linExp.a;const yexp=x.map(v=>aExp*Math.exp(bExp*v));models.push({name:"–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è",y:yexp,r2:r2(y,yexp)});}catch(e){}
  // –õ–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∞—è
  try{const logx=x.map(v=>Math.log(v));const linLogY=fitLinear(logx,y);
  const aLog=linLogY.a,bLog=linLogY.b;const ylog=x.map(v=>aLog*Math.log(v)+bLog);models.push({name:"–õ–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∞—è",y:ylog,r2:r2(y,ylog)});}catch(e){}

  const tbody=document.querySelector("#comparisonTable tbody");tbody.innerHTML="";
  models.forEach(m=>{
    let match="‚Äî";if(ytheory.length>0){match=(100-err(m.y,ytheory)).toFixed(2)+"%";}
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${m.name}</td><td>${m.r2.toFixed(4)}</td><td>${match}</td>`;
    tbody.appendChild(tr);
  });
};
</script>
</body>
</html>
