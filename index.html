<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ИИ — лабораторный помощник</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

<style>
:root {
  --bg:#f6f7f9;--card:#ffffff;--text:#202124;
  --muted:#6b7280;--border:#dcdfe3;
  --accent:#2563eb;--accent2:#7c3aed;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);
display:flex;justify-content:center;padding:40px;}
.wrap{width:100%;max-width:1200px;}
h1{font-size:24px;margin-bottom:8px;}
p{color:var(--muted);font-size:14px;}
.grid{display:grid;grid-template-columns:360px 1fr;gap:18px;}
.panel{background:var(--card);border:1px solid var(--border);
border-radius:10px;padding:18px;box-shadow:0 4px 10px rgba(0,0,0,0.04);}
textarea,input[type="text"]{width:100%;border:1px solid var(--border);
border-radius:8px;padding:8px;margin-top:6px;font-size:14px;background:#fff;}
label{font-weight:600;font-size:14px;margin-top:10px;display:block;}
button{background:var(--accent);color:white;border:none;border-radius:8px;
padding:10px 12px;font-weight:600;cursor:pointer;margin-top:12px;}
button.ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
.exp-card{display:flex;align-items:center;gap:10px;border:1px solid var(--border);
border-radius:8px;padding:8px;cursor:pointer;margin-top:6px;}
.exp-card.active{border-color:var(--accent);background:#eef2ff;}
.exp-icon{width:38px;height:38px;border-radius:6px;background:var(--accent);
color:white;display:flex;align-items:center;justify-content:center;font-weight:700;}
#plot{width:100%;height:420px;}
.pill{background:#f8fafc;padding:6px 10px;border-radius:8px;border:1px solid var(--border);font-size:13px;}
footer{color:var(--muted);font-size:12px;margin-top:20px;text-align:center;}
.tooltip{position:relative;display:inline-block;}
.tooltiptext{
visibility:hidden;background-color:#333;color:#fff;text-align:left;border-radius:6px;
padding:8px 10px;position:absolute;z-index:1;bottom:125%;left:50%;transform:translateX(-50%);
opacity:0;transition:opacity 0.3s;width:240px;font-size:12px;line-height:1.3;
}
.tooltip:hover .tooltiptext{visibility:visible;opacity:1;}
</style>
</head>
<body>
<div class="wrap">
<h1>ИИ — лабораторный помощник</h1>
<p>ИИ анализирует экспериментальные данные, подбирает оптимальную модель и объясняет свой выбор.</p>

<div class="grid" style="margin-top:20px;">
  <div class="panel">
    <strong>Эксперимент</strong>
    <div class="exp-card" data-mode="ohm"><div class="exp-icon">Ω</div><div>Закон Ома</div></div>
    <div class="exp-card" data-mode="pendulum"><div class="exp-icon">⏱</div><div>Маятник</div></div>
    <div class="exp-card" data-mode="fall"><div class="exp-icon">⬇️</div><div>Свободное падение</div></div>
    <div class="exp-card active" data-mode="custom"><div class="exp-icon">✳️</div><div>Новая зависимость</div></div>

    <label>Ряд A (X)</label>
    <textarea id="inputA" placeholder="Например: 1, 2, 3, 4"></textarea>

    <label>Ряд B (Y)</label>
    <textarea id="inputB" placeholder="Например: 2, 4.1, 5.9, 8.2"></textarea>

    <label>Проверить свою формулу (необязательно)</label>
    <input type="text" id="userFormula" placeholder="y = 2*x + 1">

    <button id="btnAnalyze">Анализировать</button>
    <button class="ghost" id="btnExample">Пример</button>
  </div>

  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div>
        <strong id="resultTitle">Готов к анализу</strong><br>
        <span id="resultSub" style="color:var(--muted);font-size:13px;">Введите данные и нажмите «Анализировать»</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div class="tooltip">
          <div class="pill" id="pillR2">R² —</div>
          <span class="tooltiptext">Коэффициент детерминации: показывает, насколько точно модель описывает данные (1 = идеально)</span>
        </div>
        <div class="tooltip">
          <div class="pill" id="pillError">Δ% —</div>
          <span class="tooltiptext">Средняя относительная погрешность между моделью и экспериментом</span>
        </div>
      </div>
    </div>

    <div id="plot"></div>
    <div style="margin-top:12px;">
      <div class="tooltip">
        <b>Лучшая модель:</b> <span id="bestModelFormula">—</span>
        <span class="tooltiptext">Выбрана по наибольшему R² и физическому смыслу зависимости</span>
      </div><br>
      <b>Теоретическая модель:</b> <span id="theoryFormula">—</span><br>
      <b>Пользовательская формула:</b> <span id="userFormulaOut">—</span>
      <div id="explanation" style="margin-top:10px;color:var(--muted);font-size:13px;"></div>
    </div>
  </div>
</div>

<footer>ИИ использует статистический анализ и сравнение моделей, чтобы подобрать физически осмысленную зависимость.</footer>
</div>

<script>
let mode='custom';
document.querySelectorAll('.exp-card').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.exp-card').forEach(x=>x.classList.remove('active'));
    c.classList.add('active'); mode=c.dataset.mode;
  });
});

function parseSeries(str){return str.split(/,|;|\s+/).map(s=>parseFloat(s)).filter(x=>!isNaN(x));}
function r2(y,yp){const m=math.mean(y);const ssr=math.sum(y.map((yi,i)=>(yi-yp[i])**2));const sst=math.sum(y.map(yi=>(yi-m)**2));return 1-ssr/sst;}
function err(y,yp){const eps=1e-9;return math.mean(y.map((yi,i)=>Math.abs(yi-yp[i])/Math.max(Math.abs(yi),eps)))*100;}
function fitLinear(x,y){const mx=math.mean(x),my=math.mean(y);const a=math.sum(x.map((xi,i)=>(xi-mx)*(y[i]-my)))/math.sum(x.map(xi=>(xi-mx)**2));return {a:a,b:my-a*mx};}
function fitQuad(x,y){try{const X=math.matrix(x.map(xi=>[xi*xi,xi,1]));const Y=math.matrix(y);const t=math.multiply(math.inv(math.multiply(math.transpose(X),X)),math.multiply(math.transpose(X),Y)).toArray().flat();return {A:t[0],B:t[1],C:t[2]};}catch(e){return{A:0,B:0,C:0};}}
function fitPower(x,y){const lx=x.map(xi=>Math.log(xi)),ly=y.map(yi=>Math.log(yi));const lin=fitLinear(lx,ly);return {a:Math.exp(lin.b),b:lin.a};}
function fitExp(x,y){const ly=y.map(yi=>Math.log(yi));const lin=fitLinear(x,ly);return {a:Math.exp(lin.b),b:lin.a};}
function fitLog(x,y){const lx=x.map(xi=>Math.log(xi));const lin=fitLinear(lx,y);return {a:lin.a,b:lin.b};}

document.getElementById('btnExample').onclick=()=>{
  if(mode==='ohm'){inputA.value='1,2,3,4';inputB.value='1,0.5,0.33,0.25';}
  else if(mode==='pendulum'){inputA.value='0.1,0.2,0.3,0.4';inputB.value='0.63,0.9,1.09,1.26';}
  else if(mode==='fall'){inputA.value='0.2,0.4,0.6,0.8';inputB.value='0.2,0.8,1.8,3.2';}
  else {inputA.value='1,2,3,4,5';inputB.value='2,4.1,5.9,8.1,9.9';}
};

document.getElementById('btnAnalyze').onclick=()=>{
  const x=parseSeries(inputA.value),y=parseSeries(inputB.value);
  if(x.length<3||x.length!==y.length){alert('Введите одинаковое количество точек');return;}

  let vars={x:'x',y:'y'};
  if(mode==='ohm') vars={x:'U',y:'I'};
  else if(mode==='pendulum') vars={x:'L',y:'T'};
  else if(mode==='fall') vars={x:'t',y:'h'};

  const models=[];
  const lin=fitLinear(x,y);const ylin=x.map(xi=>lin.a*xi+lin.b);models.push({name:'Линейная',r:r2(y,ylin),f:`${vars.y}=${lin.a.toFixed(4)}·${vars.x}${lin.b>=0?'+':'-'}${Math.abs(lin.b).toFixed(4)}`,y:ylin});
  const q=fitQuad(x,y);const yq=x.map(xi=>q.A*xi*xi+q.B*xi+q.C);models.push({name:'Квадратичная',r:r2(y,yq),f:`${vars.y}=${q.A.toFixed(4)}·${vars.x}²${q.B>=0?'+':'-'}${Math.abs(q.B).toFixed(4)}·${vars.x}${q.C>=0?'+':'-'}${Math.abs(q.C).toFixed(4)}`,y:yq});
  const pw=fitPower(x,y);const ypw=x.map(xi=>pw.a*Math.pow(xi,pw.b));models.push({name:'Степенная',r:r2(y,ypw),f:`${vars.y}=${pw.a.toFixed(4)}·${vars.x}^${pw.b.toFixed(4)}`,y:ypw});
  const ex=fitExp(x,y);const yex=x.map(xi=>ex.a*Math.exp(ex.b*xi));models.push({name:'Экспоненциальная',r:r2(y,yex),f:`${vars.y}=${ex.a.toFixed(4)}·e^{${ex.b.toFixed(4)}·${vars.x}}`,y:yex});
  const lg=fitLog(x,y);const ylg=x.map(xi=>lg.a*Math.log(xi)+lg.b);models.push({name:'Логарифмическая',r:r2(y,ylg),f:`${vars.y}=${lg.a.toFixed(4)}·ln(${vars.x})${lg.b>=0?'+':'-'}${Math.abs(lg.b).toFixed(4)}`,y:ylg});

  const best=models.reduce((a,b)=>a.r>b.r?a:b);
  const traces=[{x,y,mode:'markers',name:'Эксперимент'}];
  models.forEach(m=>traces.push({x,y:m.y,mode:'lines',name:m.name}));
  Plotly.newPlot('plot',traces,{margin:{t:30,l:60,r:20,b:60},xaxis:{title:vars.x},yaxis:{title:vars.y},legend:{orientation:'h'}});

  document.getElementById('bestModelFormula').textContent=`${best.name}: ${best.f}`;
  document.getElementById('pillR2').textContent='R² = '+best.r.toFixed(4);
  document.getElementById('pillError').textContent='Δ% = '+err(y,best.y).toFixed(2)+'%';
  document.getElementById('userFormulaOut').textContent=document.getElementById('userFormula').value.trim()||'—';
  document.getElementById('resultTitle').textContent='Анализ завершён';
  document.getElementById('explanation').innerHTML=`ИИ протестировал 5 типов моделей и выбрал <b>${best.name.toLowerCase()}</b>, так как она имеет наибольший R² (${best.r.toFixed(4)}).<br><br>
  <b>Сравнение моделей:</b><br>${models.map(m=>`${m.name}: R²=${m.r.toFixed(4)}`).join('<br>')}<br><br>
  Это значит, что зависимость ${vars.y}(${vars.x}) наиболее точно описывается функцией типа ${best.name.toLowerCase()}.`;
};
</script>
</body>
</html>
