<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ИИ — лабораторный помощник</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

<style>
  :root {
    --bg:#f5f6f8; --card:#ffffff; --text:#202124;
    --muted:#6b7280; --border:#dcdfe3;
    --accent:#2563eb;
  }
  * { box-sizing:border-box; margin:0; padding:0; }
  body {
    font-family:"Segoe UI",Roboto,Arial,sans-serif;
    background:var(--bg); color:var(--text);
    display:flex; justify-content:center; padding:40px;
  }
  .wrap{width:100%;max-width:1200px;}
  h1{font-size:24px;margin-bottom:8px;}
  p{color:var(--muted);font-size:14px;}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;}
  .panel{background:var(--card);border:1px solid var(--border);border-radius:10px;
    padding:18px;box-shadow:0 4px 10px rgba(0,0,0,0.04);}
  textarea,input[type="text"]{width:100%;border:1px solid var(--border);
    border-radius:8px;padding:8px;margin-top:6px;font-size:14px;}
  label{font-weight:600;font-size:14px;margin-top:10px;display:block;}
  button{background:var(--accent);color:white;border:none;border-radius:8px;
    padding:10px 12px;font-weight:600;cursor:pointer;margin-top:12px;}
  button.ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
  .exp-card{display:flex;align-items:center;gap:10px;border:1px solid var(--border);
    border-radius:8px;padding:8px;cursor:pointer;margin-top:6px;}
  .exp-card.active{border-color:var(--accent);background:#eef2ff;}
  .exp-icon{width:38px;height:38px;border-radius:6px;background:var(--accent);
    color:white;display:flex;align-items:center;justify-content:center;font-weight:700;}
  #plot{width:100%;height:420px;}
  .pill{background:#f8fafc;padding:6px 10px;border-radius:8px;border:1px solid var(--border);font-size:13px;}
  footer{color:var(--muted);font-size:12px;margin-top:20px;text-align:center;}
</style>
</head>
<body>
<div class="wrap">
  <h1>ИИ — лабораторный помощник</h1>
  <p>Введите экспериментальные данные, и ИИ подберёт подходящую модель, объяснит выбор и предложит альтернативы.</p>

  <div class="grid" style="margin-top:20px;">
    <!-- Левая панель -->
    <div class="panel">
      <strong>Эксперимент</strong>
      <div class="exp-card" data-mode="ohm"><div class="exp-icon">Ω</div><div>Закон Ома</div></div>
      <div class="exp-card" data-mode="pendulum"><div class="exp-icon">⏱</div><div>Маятник</div></div>
      <div class="exp-card" data-mode="fall"><div class="exp-icon">⬇️</div><div>Свободное падение</div></div>
      <div class="exp-card active" data-mode="custom"><div class="exp-icon">✳️</div><div>Новая зависимость</div></div>

      <label>Ряд A (X)</label>
      <textarea id="inputA" placeholder="Например: 1, 2, 3, 4"></textarea>

      <label>Ряд B (Y)</label>
      <textarea id="inputB" placeholder="Например: 2, 4.1, 5.9, 8.2"></textarea>

      <label>Проверить свою формулу (необязательно)</label>
      <input type="text" id="userFormula" placeholder="y = 2*x + 1">

      <button id="btnAnalyze">Анализировать</button>
      <button class="ghost" id="btnExample">Пример</button>
    </div>

    <!-- Правая панель -->
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <div>
          <strong id="resultTitle">Готов к анализу</strong><br>
          <span id="resultSub" style="color:var(--muted);font-size:13px;">Введите данные и нажмите «Анализировать»</span>
        </div>
        <div style="display:flex;gap:8px;">
          <div class="pill" id="pillR2">R² —</div>
          <div class="pill" id="pillError">Δ% —</div>
        </div>
      </div>

      <div id="plot"></div>
      <div style="margin-top:12px;">
        <div><b>Лучшая модель:</b> <span id="empFormula">—</span></div>
        <div><b>Теоретическая модель:</b> <span id="theoryFormula">—</span></div>
        <div><b>Пользовательская формула:</b> <span id="userFormulaOut">—</span></div>
        <div style="margin-top:10px;color:var(--muted);font-size:13px;" id="explanation"></div>
      </div>
    </div>
  </div>

  <footer>ИИ объясняет выбор модели по точности и физическому смыслу.</footer>
</div>

<script>
let mode='custom';
document.querySelectorAll('.exp-card').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.exp-card').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    mode=c.dataset.mode;
  });
});

function parseSeries(str){return str.split(/,|;|\s+/).map(s=>parseFloat(s)).filter(x=>!isNaN(x));}
function r2score(y, ypred){
  const meanY=math.mean(y);
  const ssRes=math.sum(y.map((yi,i)=>(yi-ypred[i])**2));
  const ssTot=math.sum(y.map(yi=>(yi-meanY)**2));
  return ssTot===0?1:1-ssRes/ssTot;
}
function meanRelativeErrorPercent(y, ypred){
  const eps=1e-9;
  const rel=y.map((yi,i)=>Math.abs(yi-ypred[i])/Math.max(Math.abs(yi),eps));
  return math.mean(rel)*100;
}
function fitLinear(x,y){
  const meanX=math.mean(x),meanY=math.mean(y);
  const num=math.sum(x.map((xi,i)=>(xi-meanX)*(y[i]-meanY)));
  const den=math.sum(x.map(xi=>(xi-meanX)**2));
  const a=den===0?0:num/den;const b=meanY-a*meanX;
  return {a,b};
}

document.getElementById('btnExample').onclick=()=>{
  if(mode==='ohm'){inputA.value='1,2,3,4';inputB.value='1,0.5,0.33,0.25';}
  else if(mode==='pendulum'){inputA.value='0.1,0.2,0.3,0.4';inputB.value='0.63,0.9,1.09,1.26';}
  else if(mode==='fall'){inputA.value='0.2,0.4,0.6,0.8';inputB.value='0.2,0.8,1.8,3.2';}
  else {inputA.value='1,2,3,4,5';inputB.value='2,4.1,5.9,8.1,9.9';}
};

document.getElementById('btnAnalyze').onclick=()=>{
  const x=parseSeries(inputA.value),y=parseSeries(inputB.value);
  if(x.length<3||x.length!==y.length){alert("Введите минимум 3 точки одинаковой длины");return;}

  // Определяем величины
  let vars={x:'x',y:'y'};
  if(mode==='ohm') vars={x:'U',y:'I'};
  else if(mode==='pendulum') vars={x:'L',y:'T²'};
  else if(mode==='fall') vars={x:'t²',y:'h'};

  // Для маятника и падения преобразуем оси
  let xCalc=x.slice(), yCalc=y.slice();
  if(mode==='pendulum') yCalc=y.map(v=>v*v);
  if(mode==='fall') xCalc=x.map(v=>v*v);

  const {a,b}=fitLinear(xCalc,yCalc);
  const y_pred=xCalc.map(xi=>a*xi+b);
  const r2=r2score(yCalc,y_pred);

  // Формула в физических переменных
  let formula=`${vars.y} = ${a.toFixed(3)}·${vars.x} ${b>=0?'+':'-'} ${Math.abs(b).toFixed(3)}`;

  // Теоретическая модель
  let theory='', y_theory=[];
  if(mode==='ohm'){
    const R=Math.abs(1/a);
    theory=`I = U / R  (R ≈ ${R.toFixed(3)} Ω)`;
    y_theory=x.map(U=>U/R);
  } else if(mode==='pendulum'){
    const g=Math.abs((4*Math.PI**2)/a);
    theory=`T = 2π√(L/g)  (g ≈ ${g.toFixed(3)} м/с²)`;
    y_theory=x.map(L=>2*Math.PI*Math.sqrt(L/g));
  } else if(mode==='fall'){
    const g=Math.abs(2*a);
    theory=`h = ½·g·t²  (g ≈ ${g.toFixed(3)} м/с²)`;
    y_theory=x.map(t=>0.5*g*t*t);
  }
  const err=y_theory.length?meanRelativeErrorPercent(y,y_theory):null;

  // Графики
  const traces=[{x,y,mode:'markers',name:'Эксперимент',marker:{size:7}},
                {x,y:y_pred,mode:'lines',name:'Эмпирическая модель',line:{width:3,color:'#2563eb'}}];
  if(y_theory.length) traces.push({x,y:y_theory,mode:'lines',name:'Теоретическая модель',line:{width:3,dash:'dot',color:'#f97316'}});
  Plotly.newPlot('plot',traces,{margin:{t:30,l:60,r:20,b:60},xaxis:{title:vars.x},yaxis:{title:vars.y},legend:{orientation:'h'}});

  // Вывод
  document.getElementById('resultTitle').textContent='Анализ завершён';
  document.getElementById('empFormula').textContent=formula;
  document.getElementById('theoryFormula').textContent=theory||'—';
  document.getElementById('userFormulaOut').textContent=document.getElementById('userFormula').value.trim()||'—';
  document.getElementById('pillR2').textContent='R² = '+r2.toFixed(4);
  document.getElementById('pillError').textContent='Δ% = '+(err?err.toFixed(2)+'%':'—');
  document.getElementById('explanation').innerHTML=`ИИ использовал линейную аппроксимацию между величинами ${vars.x} и ${vars.y}. 
  Полученная формула выражает зависимость в физических переменных, а не в x и y.`;
};
</script>
</body>
</html>
